<!DOCTYPE html>
<html lang="en">
<head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="./cookie.js"></script>
    <link rel="stylesheet" href="index.css">
    <title>Game</title>
</head>
<body>
<canvas width="480" height="320" id="game-container">

</canvas>
<script>
    const socket = io();
    socket.on('connect', () => {
        socket.emit('set name', getCookie('name'));
    });

    const radius = 5;
    const pi2 = Math.PI * 2;

    const canvas = document.getElementById('game-container');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const ctx = canvas.getContext("2d");

    socket.on('update state', (states) => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'red'
        ctx.beginPath();
        for (const i in states) {
            const p = states[i];
            ctx.moveTo(p.x + radius, p.y);
            ctx.arc(p.x, p.y, radius, 0, pi2);
            ctx.fillText(p.name, p.x - 3 * radius + 0.5, p.y - 2 * radius);
        }
        ctx.stroke();
        ctx.fill();
    });

    const keysPressed = {}
    document.body.addEventListener('keydown', (e) => {
        keysPressed[e.key] = true;
    });

    document.body.addEventListener('keyup', (e) => {
        delete keysPressed[e.key];
    });

    setInterval(() => {
        for (const i in keysPressed) {
            if (i === 's') socket.emit('move down');
            else if (i === 'w') socket.emit('move up');
            else if (i === 'a') socket.emit('move left');
            else if (i === 'd') socket.emit('move right');
        }
    }, 10);
</script>
</body>
</html>
